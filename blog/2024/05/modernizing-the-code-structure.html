<!DOCTYPE html>
<html lang="en">
<head>
    

  
  

  
  

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Modernizing the AntennaPod Code Structure ‚Äì AntennaPod</title>
  <meta name="description" content="How we spent the last 3 years restructuring the AntennaPod code base.">

  <link rel="canonical" href="https://antennapod.org/blog/2024/05/modernizing-the-code-structure">
  <link rel="alternate" type="application/rss+xml" title="Blog posts" href="/rss.xml">

  <!-- Social: Twitter -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Modernizing the AntennaPod Code Structure ‚Äì AntennaPod">
  <meta name="twitter:description" content="How we spent the last 3 years restructuring the AntennaPod code base.">
  <meta name="twitter:image" content="https://antennapod.org/assets/images/blog/2024/codeStructureTeaser.jpg">

  <!-- Social: Facebook / Open Graph -->
  <meta property="og:url" content="https://antennapod.org/blog/2024/05/modernizing-the-code-structure">
  <meta property="og:title" content="Modernizing the AntennaPod Code Structure ‚Äì AntennaPod">
  <meta property="og:image" content="https://antennapod.org/assets/images/blog/2024/codeStructureTeaser.jpg">
  <meta property="og:description" content="How we spent the last 3 years restructuring the AntennaPod code base.">
  <meta property="og:site_name" content="AntennaPod">

  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/branding/favicons/apple-touch-icon.png?v=2">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/branding/favicons/favicon-32x32.png?v=2">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/branding/favicons/favicon-16x16.png?v=2">
  <link rel="manifest" href="/assets/branding/favicons/site.webmanifest?v=2">
  <link rel="mask-icon" href="/assets/branding/favicons/safari-pinned-tab.svg?v=2" color="#364ff3">
  <link rel="shortcut icon" href="/assets/branding/favicons/favicon.ico?v=2">
  <meta name="msapplication-TileColor" content="#364ff3">
  <meta name="msapplication-config" content="/assets/branding/favicons/browserconfig.xml?v=2">
  <meta name="theme-color" content="#ffffff">

  <!-- Resources -->
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/fontawesome/css/all.min.css">
  <script src="/assets/js/jquery.min.js"></script>
  <script src="/assets/js/bootstrap.bundle.min.js"></script>
  <script defer src="/assets/js/search.min.js"></script>
  <script defer src="/assets/js/tooltip.js"></script>
  <script defer src="/assets/js/copy-url.js"></script>
  <script defer src="/assets/js/mastodon-share.js"></script>

</head>
<body dir="auto">
  <div class="content">
  <div class="w-100 fixed background-gray-100">
  <div class="container px-0 py-2 py-md-4">
    <div class="navbar navbar-expand-xl">

      <div class="col">
        <a href="/">
          <img src="/assets/branding/logo-full-horizontal-dynamic.svg" id="mainlogo">
        </a>
      </div>

      <div class="col-auto">
        <div class="collapse navbar-collapse flex-grow-0 weight-500">
          <div class="navbar-nav align-items-center">
            
            
            
            
            <div class="nav-item ml-2">
              <a class="nav-link" href="/about">
                About
              </a>
            </div>
            
            
            
            
            <div class="nav-item ml-2 active">
              <a class="nav-link" href="/blog">
                Blog
              </a>
            </div>
            
            
            
            
            <div class="nav-item ml-2">
              <a class="nav-link" href="/events">
                Events
              </a>
            </div>
            
            
            
            
            <div class="nav-item ml-2">
              <a class="nav-link" href="/contribute">
                Contribute
              </a>
            </div>
            
            
            
            
            <div class="nav-item ml-2">
              <a class="nav-link" href="/documentation">
                Documentation
              </a>
            </div>
            
            
            
            
            <div class="nav-item ml-2">
              <a class="nav-link" href="https://forum.antennapod.org/">
                Forum
              </a>
            </div>
            
            <div class="nav-item ml-2 ml-sm-1 text-center">
              <div class="nav-item dropdown mb-0">
                <button class="nav-link dropdown-toggle" id="navbarDropdown1" aria-label="Language switcher" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="fa fa-globe size-16 color-gray-900"></i>
                  <span class="ml-1 mr-1 size-16 color-gray-900 weight-600">EN</span>
                </button>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown1">
                  

  
    <a class="dropdown-item" onchange="location = this.value;" href="/da/blog/2024/05/modernizing-the-code-structure">Dansk</a>
  

  
    <a class="dropdown-item" onchange="location = this.value;" href="/de/blog/2024/05/modernizing-the-code-structure">Deutsch</a>
  

  
    <a class="dropdown-item" onchange="location = this.value;" href="/blog/2024/05/modernizing-the-code-structure">English</a>
  

  
    <a class="dropdown-item" onchange="location = this.value;" href="/es/blog/2024/05/modernizing-the-code-structure">Espa√±ol</a>
  

  
    <a class="dropdown-item" onchange="location = this.value;" href="/fr/blog/2024/05/modernizing-the-code-structure">Fran√ßais</a>
  

  
    <a class="dropdown-item" onchange="location = this.value;" href="/it/blog/2024/05/modernizing-the-code-structure">Italiano</a>
  

  
    <a class="dropdown-item" onchange="location = this.value;" href="/nl/blog/2024/05/modernizing-the-code-structure">Nederlands</a>
  

  
    <a class="dropdown-item" onchange="location = this.value;" href="/fa/blog/2024/05/modernizing-the-code-structure">ŸÅÿßÿ±ÿ≥€å</a>
  

  
    <a class="dropdown-item" onchange="location = this.value;" href="/ja/blog/2024/05/modernizing-the-code-structure">Êó•Êú¨Ë™û</a>
  


                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="d-xl-none">
          <div class="nav-item text-center d-inline-block">
            <div class="nav-item dropdown">
              <button class="nav-link dropdown-toggle" id="navbarDropdown2" aria-label="Language switcher" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fa fa-globe size-16 color-gray-900"></i><span class="ml-1 size-16 color-gray-900 weight-600">EN</span>
              </button>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown2">
              

  
    <a class="dropdown-item" onchange="location = this.value;" href="/da/blog/2024/05/modernizing-the-code-structure">Dansk</a>
  

  
    <a class="dropdown-item" onchange="location = this.value;" href="/de/blog/2024/05/modernizing-the-code-structure">Deutsch</a>
  

  
    <a class="dropdown-item" onchange="location = this.value;" href="/blog/2024/05/modernizing-the-code-structure">English</a>
  

  
    <a class="dropdown-item" onchange="location = this.value;" href="/es/blog/2024/05/modernizing-the-code-structure">Espa√±ol</a>
  

  
    <a class="dropdown-item" onchange="location = this.value;" href="/fr/blog/2024/05/modernizing-the-code-structure">Fran√ßais</a>
  

  
    <a class="dropdown-item" onchange="location = this.value;" href="/it/blog/2024/05/modernizing-the-code-structure">Italiano</a>
  

  
    <a class="dropdown-item" onchange="location = this.value;" href="/nl/blog/2024/05/modernizing-the-code-structure">Nederlands</a>
  

  
    <a class="dropdown-item" onchange="location = this.value;" href="/fa/blog/2024/05/modernizing-the-code-structure">ŸÅÿßÿ±ÿ≥€å</a>
  

  
    <a class="dropdown-item" onchange="location = this.value;" href="/ja/blog/2024/05/modernizing-the-code-structure">Êó•Êú¨Ë™û</a>
  


            </div>
          </div>
        </div>

        <button class="navbar-toggler" onclick="openNav()"><img src="/assets/images/icons/burger.svg"></button>
      </div>

    </div>
  </div>

  <div id="navbar-mobile" class="overlay">
    <button class="closebtn" onclick="closeNav()">√ó</button>
      <div class="overlay-header">
        <img src="/assets/branding/logo-icon.svg" width="80" alt="AntennaPod Logo">
      </div>
      <div class="overlay-content">
        
        <a href="/about">About</a>
        
        <a href="/blog">Blog</a>
        
        <a href="/events">Events</a>
        
        <a href="/contribute">Contribute</a>
        
        <a href="/documentation">Documentation</a>
        
        <a href="https://forum.antennapod.org/">Forum</a>
        
      </div>
      <div class="overlay-footer">
        
        <a class="mr-2 color-gray-900" href="https://fosstodon.org/@AntennaPod" target="_blank" rel="me noopener"><i class="fa-brands fa-mastodon mr-1"></i>Mastodon</a>
        
        
        <a class="mr-2 color-gray-900" href="https://github.com/AntennaPod" target="_blank" rel="noopener"><i class="fa-brands fa-github mr-1"></i>GitHub</a>
        
        
        <a class="mr-2 color-gray-900" href="https://bsky.app/profile/AntennaPod.org" target="_blank" rel="noopener"><i class="fa-brands fa-bluesky mr-1"></i>Bluesky</a>
        
        
        <a class="mr-2 color-gray-900" href="https://twitter.com/antennapod" target="_blank" rel="noopener"><i class="fa-brands fa-x-twitter mr-1"></i>Twitter</a>
        
      </div>
    </div>
  </div>
</div>

<script>
    function openNav() {
        document.getElementById("navbar-mobile").style.height = "100%";
        document.documentElement.style.overflow = 'hidden';
        document.body.scroll = "no";
    }

    function closeNav() {
        document.getElementById("navbar-mobile").style.height = "0%";
        document.documentElement.style.overflow = 'scroll';
        document.body.scroll = "yes";
    }
</script>

  <div class="container-fluid" dir="ltr">
    <div class="container py-3">
      <div class="row no-gutters justify-content-center">
        <div class="col-lg-9 col-sm-12 pt-3">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb p-0" id="breadcrumbs">
              <li class="breadcrumb-item"><a href="/">Home</a></li>
              <li class="breadcrumb-item"><a href="/blog">Blog</a></li>
              <li class="breadcrumb-item active" aria-current="page">Modernizing the AntennaPod Code Structure</li>
            </ol>
          </nav>
          <div class="post">

            

            <header class="post-header">
              <h1 class="size-36 weight-700 color-gray-900">Modernizing the AntennaPod Code Structure</h1>
              
              
              <p class="size-14 weight-600 color-gray-500">8 min read</p>
              
              <div class="row no-gutters align-items-center justify-content-between my-3">
                <p class="size-14 weight-700 color-gray-900 mb-0">
                  
                  <img class="round-img" src="/assets/images/authors/bytehamster.png" width="40">
                  <a class="underline" href="https://github.com/ByteHamster" target="_blank" rel="noopener">ByteHamster</a>
                  
                  ‚Ä¢
                  
                  May 12, 2024
                </p>
                <div class="inline-flex">
  <p class="size-14 color-gray-900 mb-0 mr-2">Share</p>
  <button title="Copy link" class="copy-link" onclick="copyUrl();" data-toggle="tooltip" data-trigger="click" data-selector="true" data-title="Link copied!" value="https://antennapod.org/blog/2024/05/modernizing-the-code-structure">
      <i class="fa-solid fa-link color-gray-600 size-20 mr-2"></i>
  </button>
  <a title="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://antennapod.org/blog/2024/05/modernizing-the-code-structure" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <i class="fa-brands fa-facebook color-gray-600 size-20 mr-2"></i>
  </a>
  <a title="Share on Mastodon" href="#" onclick="share_on_mastodon();">
      <i class="fa-brands fa-mastodon size-20 color-gray-600 mr-2"></i>
  </a>
  <a title="Share on Twitter" href="https://twitter.com/intent/tweet?text=https://antennapod.org/blog/2024/05/modernizing-the-code-structure&amp;hashtags=&amp;via=AntennaPod" onclick="window.open(this.href, 'twitter-share', 'width=550,height=350');return false;">
      <i class="fa-brands fa-x-twitter size-20 color-gray-600 mr-2"></i>
  </a>
  <a title="Share via email" href="mailto:?subject=I%20wanted%20you%20to%20see%20this&amp;body=I%20wanted%20you%20to%20see%20this%20https://antennapod.org/blog/2024/05/modernizing-the-code-structure">
      <i class="fa-solid fa-envelope size-20 color-gray-600"></i>
  </a>
</div>

              </div>
            </header>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="container-fluid" dir="ltr">
    <div class="container py-3">
      <div class="row no-gutters justify-content-center pb-4">
        <div class="col-lg-9">
          <article class="post-content pb-3">
            <p class="lead">AntennaPod has been around for a long time - the first bit of code was published in 2011. Since then, the app has grown massively and had several main developers. The beauty of open-source is that so many people can contribute and make a great app together. But sometimes having many people work on a project can lead to different ways of thinking about how to structure the project. Because of this, AntennaPod gradually grew to have a number of weird code constructs. Our latest release, version 3.4, fixes this.</p>

<h2 id="bringing-the-problem-to-the-table">Bringing the problem to the table</h2>

<p>In November 2020, <a href="https://github.com/damoasda" class="user-mention">@damoasda</a> pointed us to this problem in an <a href="https://github.com/AntennaPod/AntennaPod/issues/4661">issue</a> on our bug tracker. It made the situation very clear with a graph of AntennaPod‚Äôs code structure.</p>

<p><a data-toggle="modal" data-target="#imgModalcodeStructureBeforepng" style="cursor: pointer;">
  <img src="/assets/images/blog/2024/codeStructureBefore.png" alt="A graph with 41 ovals and many seemingly tangled up arrows connecting them." style="" class="rounded mt-2 ">
</a></p>

<div class="modal fade" id="imgModalcodeStructureBeforepng" tabindex="-1" role="dialog" aria-labelledby="imgModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content rounded">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="position: absolute; top: 1rem; right: 1rem;">
          <i class="fas fa-times-circle"></i>
        </button>
        <img src="/assets/images/blog/2024/codeStructureBefore.png" alt="A graph with 41 ovals and many seemingly tangled up arrows connecting them." width="100%" class="rounded">
    </div>
  </div>
</div>

<p>As you can see, the structure was one large knot. Arrows went everywhere, indicating that the different areas of the app were all connected and influenced each other. The largest problem is that there are cycles in the graph. For example, the synchronization feature accessed the database to store its changes. In turn, the database could access the playback component in case someone deletes a playing episode. To synchronize the playback position, the player could then again access the synchronization feature.</p>

<p>Cycles like this make it harder to create automated tests that ensure that changes do not break any existing functionality. To test the database, for example, one normally wouldn‚Äôt have to launch the full app. However, because the database basically depended on everything else, most of our tests required starting up a full Android device.</p>

<p>A particularly problematic aspect of the structure was that there were many ‚Äúutility‚Äù classes. These are sections of code that normally do a specific task, but in our case covered various things. Such classes make it easy to just stuff everything inside, without thinking whether the code should actually be stored somewhere else. These utility classes caused many of the cycles visible in the structure.</p>

<h2 id="the-big-cleanup">The Big Cleanup</h2>
<p>To clean up the code structure we started working from the graph above, identifying cycles between classes. Or, more precisely, we determined ‚Äústrongly connected components‚Äù using the graph analysis tool <a href="https://gephi.org/">Gephi</a>. Given the analysis and with the help of visualizations of the code structure, we got to work.</p>

<p>In the beginning we mainly removed interdependencies between classes, to break the problematic cycles. Later we began grouping files using modules. A module is a collection of source code files that belong together. When some part of the code is split into a module, it stands for itself and can no longer cause cycles. <a href="https://github.com/damoasda" class="user-mention">@damoasda</a> (who, as mentioned, pointed us to the problem) contributed several of the early changes.</p>

<p>Three years later, we now have finally completed the code restructuring. We created 62 pull requests and touched about 10 000 lines of source code ‚Äì for the restructuring alone. Throughout this major undertaking, development continued. We introduced new features like local folders (2020), episode notifications, tags for subscriptions, swipe actions (all 2021), synchronization with gPodder for Nextcloud, Podcasting 2.0 chapters (both 2022) and, more recently, the Home screen and AntennaPod Echo (2023) ‚Äì just to name a few.</p>

<h2 id="the-result">The Result</h2>
<p>Today, the code structure of AntennaPod looks significantly more clean, as you can see in the graph below.</p>

<p><a data-toggle="modal" data-target="#imgModalcodeStructureAfterpng" style="cursor: pointer;">
  <img src="/assets/images/blog/2024/codeStructureAfter.png" alt="A graph with 31 ovals and a recognisable set of arrows between them." style="" class="rounded mt-2 ">
</a></p>

<div class="modal fade" id="imgModalcodeStructureAfterpng" tabindex="-1" role="dialog" aria-labelledby="imgModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content rounded">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="position: absolute; top: 1rem; right: 1rem;">
          <i class="fas fa-times-circle"></i>
        </button>
        <img src="/assets/images/blog/2024/codeStructureAfter.png" alt="A graph with 31 ovals and a recognisable set of arrows between them." width="100%" class="rounded">
    </div>
  </div>
</div>

<p>All code is structured into modules that bundle closely related files. While there are still many dependencies between the modules, there are no longer any cycles: All the arrows point downwards now. Below, you can find a time lapse of the AntennaPod code structure ‚Äì from the first released bits of code in 2011 to the structure today in 2024. The video was created using <a href="https://github.com/acaudwell/Gource">Gource</a>, which is a great tool to visualize code projects over time.</p>

<p><a href="https://www.youtube.com/watch?v=kILkeiLGkJY" target="_blank" rel="noreferrer">
<img src="/assets/images/blog/2024/codeStructureVideoPreview.png" alt="Still from the video representing code structure changes. Link opens the video YouTube.">
</a></p>

<p>In the beginning, AntennaPod started as a single module. In a large firework in the video (around 0:25), it switched to two modules in 2013, with the goal to make the app easier to maintain. However, it stayed with these two modules (<code class="language-plaintext highlighter-rouge">app</code> and <code class="language-plaintext highlighter-rouge">core</code>) for 7 years after that. The video shows that in that time many of the changes needed to touch files all over the project ‚Äì because everything was connected.</p>

<p>From 2021 you can see the effects of our restructuring work: the two large modules slowly beginning to shrink and get replaced with a handfull of smaller modules. In a final firework of changes, we completed the restructuring in 2024. Now the code is a lot more balanced with several small modules instead of these two ‚Äúarms‚Äù that could be observed between 2013 and 2021. We believe that this change wil help AntennaPod grow faster and more sustainably in the future.</p>

<p>When watching the video, also have a look at how many people worked on AntennaPod over the years! In the beginning it started with only Daniel, the original creator of AntennaPod. Since then, AntennaPod received contributions by over 200 people. Reading the names that flash by in the video brings up memories of great teamwork with contributors, some of which stayed for a long time. The video clearly shows how active and organic our favorite podcast app is to this day! If you are a contributor: Can you spot yourself? üôÇ</p>

<h2 id="the-future">The Future</h2>
<p>The restructuring enables much easier testing, which might lead to an even more stable app in the future. New developers might need to get used to having so many modules. But it can also help getting a better overview of the code structure.</p>

<p>The modules make dependencies between different components of the app more explicit, and make it harder to write spaghetti code. When it comes to development, the module structure enables faster builds because the modules can be compiled in parallel. Additionally, it allows to push forward future code quality improvements gradually on a per-module basis.</p>

<p>We plan to further improve the code structure in future, but the biggest part of it is now completed. We hope that our final rounds of restructuring did not introduce any bugs. If you find any, we would be happy to read your report on our <a href="https://forum.antennapod.org/c/bug-report/">forum</a>. We are looking forward to what the future will bring to a better structured AntennaPod.</p>

<p>Now switch over to AntennaPod and enjoy listening to your podcasts!</p>

          </article>
        </div>
      </div>
    </div>
  </div>

  <footer>
  <div class="container-fluid no-padding">
    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 1440 320">
      <path class="svg-wave" fill="#00000" fill-opacity="0" d="M0,160L80,181.3C160,203,320,245,480,245.3C640,245,800,203,960,197.3C1120,192,1280,224,1360,240L1440,256L1440,320L1360,320C1280,320,1120,320,960,320C800,320,640,320,480,320C320,320,160,320,80,320L0,320Z">
      </path>
    </svg>
  </div>
  <div class="container-fluid pb-2 bg-body-tertiary">
    <div class="container">
      <div class="row pt-2 mb-4 mb-lg-3 justify-content-between">
        <div class="col-12 col-lg-4 col-md-12 mb-3">
          <div class="mb-4 mb-lg-3">
            <a href="/">
              <img src="/assets/branding/logo-full-horizontal-dynamic.svg" width="260" alt="AntennaPod Logo">
            </a>
          </div>
          <p class="small mb-3">The easy-to-use, flexible and open-source podcast manager for Android.</p>
        </div>
        <div class="col-0 col-lg-2"></div>
        <div class="col-6 col-lg-2 col-md-4 col-sm-4 mb-3">
          <div class="mb-2">
            <a href="/about">
              About
            </a>
          </div>
          <div class="mb-2">
            <a href="/blog">
              Blog
            </a>
          </div>
          <div class="mb-2">
            <a href="/contribute">
              Contribute
            </a>
          </div>
          <div class="mb-2">
            <a href="/documentation">
              Documentation
            </a>
          </div>
        </div>
        <div class="col-6 col-lg-2 col-md-4 col-sm-4 mb-3">
          <div class="mb-2">
            <a href="/download">
              Download AntennaPod
            </a>
          </div>
          <!--<div class="mb-2">-->
          <!--  <a href="/media-kit">-->
          <!--    <span>Media Kit</span>-->
          <!--  </a>-->
          <!--</div>-->
        </div>
        <div class="col-5 col-lg-2 col-md-4 col-sm-4">
          
          <p class="mb-2">
            <a class="mr-2" href="https://fosstodon.org/@AntennaPod" target="_blank" rel="me noopener">
              <i class="fa-brands fa-mastodon mr-1 ml-1"></i>Mastodon
            </a>
          </p>
          
          
          <p class="mb-2">
            <a class="mr-2" href="https://github.com/AntennaPod" target="_blank" rel="noopener">
              <i class="fa-brands fa-github mr-1 ml-1"></i>GitHub
            </a>
          </p>
          
          
          <p class="mb-2">
            <a class="mr-2" href="https://bsky.app/profile/AntennaPod.org" target="_blank" rel="noopener">
              <i class="fa-brands fa-bluesky mr-1 ml-1"></i>Bluesky
            </a>
          </p>
          
          
          <p class="mb-2">
            <a class="mr-2" href="https://twitter.com/antennapod" target="_blank" rel="noopener">
              <i class="fa-brands fa-x-twitter mr-1 ml-1"></i>Twitter
            </a>
          </p>
          
          <p>
            <a class="mr-2" href="/rss.xml" target="_blank" rel="noopener">
              <i class="fa fa-rss mr-1 ml-1"></i>RSS
            </a>
          </p>
        </div>
      </div>
      <p class="top-border mb-2"></p>
      <div class="d-block d-lg-flex justify-content-between pt-0 pb-3 copyright">
        <div class="small mb-2 mb-lg-0">
          ¬©¬†2026¬†AntennaPod
          <span class="mx-1">|</span>
          <a class="underline-hover" href="/license">License</a>
          <span class="mx-1">|</span>
          <a class="underline-hover" href="/privacy">Privacy Policy</a>
        </div>
      </div>
    </div>
  </div>
</footer>

</body>

</html>
